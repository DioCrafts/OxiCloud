let e={_cache:new Map,_ready:!1,_authHeaders(){let e=localStorage.getItem("oxicloud_token"),i={};return e&&(i.Authorization=`Bearer ${e}`),i;},_cacheKey:(e,i)=>`${i}:${e}`,_icon:(e,i="")=>window.oxiIcon?window.oxiIcon(e,i):"",_replaceCacheFromResponse(e){for(let i of(this._cache.clear(),e))this._cache.set(this._cacheKey(i.item_id,i.item_type),i);this._ready=!0,console.log(`Favorites cache replaced from response: ${this._cache.size} items`);},async init(){console.log("Initializing favorites module (server-authoritative)"),await this._fetchFromServer();},async _fetchFromServer(){try{let e=await fetch("/api/favorites",{headers:this._authHeaders()});if(!e.ok){console.warn(`Favorites API returned ${e.status}`),this._ready=!0;return;}let i=await e.json();for(let e of(this._cache.clear(),i))this._cache.set(this._cacheKey(e.item_id,e.item_type),e);this._ready=!0,console.log(`Favorites cache loaded: ${this._cache.size} items`);}catch(e){console.error("Error fetching favorites:",e),this._ready=!0;}},isFavorite(e,i){return this._cache.has(this._cacheKey(e,i));},async addToFavorites(e,i,t,r){try{let r=await fetch(`/api/favorites/${t}/${e}`,{method:"POST",headers:this._authHeaders()});if(!r.ok)throw Error(`Server returned ${r.status}`);return await this._fetchFromServer(),window.ui&&window.ui.showNotification&&window.ui.showNotification(window.i18n?window.i18n.t("favorites.added_title"):"Added to favorites",`"${i}" ${window.i18n?window.i18n.t("favorites.added_msg"):"added to favorites"}`),!0;}catch(e){return console.error("Error adding to favorites:",e),!1;}},async removeFromFavorites(e,i){try{let t=this._cache.get(this._cacheKey(e,i)),r=t?.item_name||e,o=await fetch(`/api/favorites/${i}/${e}`,{method:"DELETE",headers:this._authHeaders()});if(!o.ok)throw Error(`Server returned ${o.status}`);return this._cache.delete(this._cacheKey(e,i)),window.ui&&window.ui.showNotification&&window.ui.showNotification(window.i18n?window.i18n.t("favorites.removed_title"):"Removed from favorites",`"${r}" ${window.i18n?window.i18n.t("favorites.removed_msg"):"removed from favorites"}`),!0;}catch(e){return console.error("Error removing from favorites:",e),!1;}},async displayFavorites(){try{this._ready||await this._fetchFromServer();let e=document.getElementById("files-grid"),i=document.getElementById("files-list-view");if(e.innerHTML="",i.innerHTML=`
                <div class="list-header">
                    <div class="list-header-checkbox"><input type="checkbox" id="select-all-checkbox" title="Select all"></div>
                    <div data-i18n="files.name">Name</div>
                    <div data-i18n="files.type">Type</div>
                    <div data-i18n="files.size">Size</div>
                    <div data-i18n="files.modified">Modified</div>
                </div>
            `,window.ui.updateBreadcrumb(""),0===this._cache.size){let i=document.createElement("div");i.className="empty-state",i.innerHTML=`
                    ${this._icon("star")}
                    <p>${window.i18n?window.i18n.t("favorites.empty_state"):"No favorite items"}</p>
                    <p>${window.i18n?window.i18n.t("favorites.empty_hint"):"To mark as favorite, right-click on any file or folder"}</p>
                `,e.appendChild(i);return;}let t=[],r=[];for(let e of this._cache.values())"folder"===e.item_type?t.push({id:e.item_id,name:e.item_name||e.item_id,parent_id:e.parent_id||"",modified_at:e.modified_at||e.created_at}):r.push({id:e.item_id,name:e.item_name||e.item_id,folder_id:e.parent_id||"",mime_type:e.item_mime_type,icon_class:e.icon_class,icon_special_class:e.icon_special_class,category:e.category,size:e.item_size||0,size_formatted:e.size_formatted,modified_at:e.modified_at||e.created_at});t.length&&window.ui.renderFolders(t),r.length&&window.ui.renderFiles(r);}catch(e){console.error("Error displaying favorites:",e),window.ui&&window.ui.showNotification&&window.ui.showNotification("Error","Error loading favorite items");}}};window.favorites=e;